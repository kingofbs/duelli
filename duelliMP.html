<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Duelli Multiplayer - Sfida online!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Stardos+Stencil&display=swap" rel="stylesheet" />

  <style>
    /* Stesso CSS di prima */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Stardos Stencil', cursive;
      background-color: #a2d4f0;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #3b2f2f;
      user-select: none;
    }
    h1 {
      font-size: 3em;
      margin-bottom: 20px;
      text-shadow: 3px 3px #fff;
    }
    #nicknameInput {
      font-family: 'Stardos Stencil', cursive;
      font-size: 1.3em;
      padding: 10px 15px;
      border: 3px solid #c79549;
      border-radius: 10px;
      width: 260px;
      margin-bottom: 20px;
      text-align: center;
      outline: none;
      transition: border-color 0.3s ease;
    }
    #nicknameInput:focus {
      border-color: #a7742e;
    }
    button {
      font-family: 'Stardos Stencil', cursive;
      font-size: 1.4em;
      padding: 12px 30px;
      border-radius: 15px;
      border: none;
      background-color: #c79549;
      color: white;
      cursor: pointer;
      margin: 5px;
      box-shadow: 4px 4px 0 #3b2f2f;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    button:hover:not(:disabled) {
      background-color: #a7742e;
      transform: scale(1.05);
    }
    button:disabled {
      background-color: #ddd;
      color: #888;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    #gameArea {
      margin-top: 30px;
      width: 90vw;
      max-width: 600px;
      background-color: #d2c4a1;
      border-radius: 20px;
      box-shadow: 6px 6px 0 #3b2f2f;
      padding: 30px;
      text-align: center;
      position: relative;
      transition: background-color 0.4s ease;
      user-select: none;
    }
    #statusMsg {
      font-size: 1.7em;
      margin-top: 20px;
      min-height: 2em;
      font-weight: bold;
      text-shadow: 2px 2px 0 #fff;
    }
    #instructions {
      margin-top: 15px;
      font-size: 1.1em;
      font-style: italic;
      color: #4e4e4e;
      user-select: text;
    }
    .playersRow {
      display: flex;
      justify-content: space-around;
      margin-top: 25px;
      align-items: center;
      user-select: none;
    }
    .playerBox {
      background-color: #f6f1dc;
      border: 3px solid #c79549;
      border-radius: 15px;
      width: 45%;
      padding: 20px;
      box-shadow: 3px 3px 0 #3b2f2f;
      position: relative;
    }
    .playerName {
      font-weight: bold;
      font-size: 1.4em;
      margin-bottom: 10px;
      text-align: center;
      user-select: text;
    }
    .playerLabel {
      font-size: 1em;
      color: #7d6a3f;
      margin-bottom: 8px;
      text-align: center;
      font-style: italic;
      user-select: text;
    }
    #signal {
      height: 30px;
      width: 100%;
      margin-top: 20px;
      border-radius: 10px;
      background-color: #87ceeb; /* azzurro iniziale */
      box-shadow: inset 0 0 8px #fff;
      transition: background-color 0.6s ease;
    }
    #footer {
      margin-top: 30px;
      font-size: 0.9em;
      color: #444;
      user-select: none;
    }
  </style>
</head>
<body>

  <h1>ðŸ¤  DUELLI Multiplayer</h1>

  <input
    type="text"
    id="nicknameInput"
    placeholder="Inserisci il tuo nickname"
    maxlength="15"
    autocomplete="off"
  />

  <button id="startBtn">Inizia il Duello</button>

  <div id="gameArea" style="display:none;">
    <div class="playersRow">
      <div class="playerBox" id="playerBox">
        <div class="playerLabel">Tu</div>
        <div class="playerName" id="playerName">--</div>
      </div>
      <div class="playerBox" id="botBox">
        <div class="playerLabel">Avversario</div>
        <div class="playerName" id="botName">--</div>
      </div>
    </div>

    <div id="signal"></div>

    <div id="instructions">
      Aspetta il cambio di colore e poi premi <strong>Barra Spaziatrice</strong> o <strong>tocca lo schermo</strong> per sparare!
    </div>

    <div id="statusMsg"></div>

    <div>
      <button id="playAgainBtn" disabled>Gioca Ancora</button>
      <button id="changeBotBtn" disabled>Cambia Avversario</button>
    </div>
  </div>

  <!-- Suoni -->
  <audio id="gunshot" src="https://assets.mixkit.co/sfx/download/mixkit-fast-small-fire-shot-1665.wav" preload="auto"></audio>
  <audio id="winSound" src="https://assets.mixkit.co/sfx/download/mixkit-winning-notification-2018.wav" preload="auto"></audio>
  <audio id="loseSound" src="https://assets.mixkit.co/sfx/download/mixkit-player-losing-or-failing-2042.wav" preload="auto"></audio>

  <script>
    (() => {
      const startBtn = document.getElementById('startBtn');
      const nicknameInput = document.getElementById('nicknameInput');
      const gameArea = document.getElementById('gameArea');
      const playerNameDisplay = document.getElementById('playerName');
      const botNameDisplay = document.getElementById('botName');
      const signal = document.getElementById('signal');
      const statusMsg = document.getElementById('statusMsg');
      const playAgainBtn = document.getElementById('playAgainBtn');
      const changeBotBtn = document.getElementById('changeBotBtn');

      const gunshot = document.getElementById('gunshot');
      const winSound = document.getElementById('winSound');
      const loseSound = document.getElementById('loseSound');

      // Lista di nomi realistici per bot
      const botNicknames = [
        'DeadEye42', 'BillyBang', 'WestShot', 'RustyRifle', 'Cowpoke99', 'SharpSix', 'QuickDraw', 'SlySnake',
        'DustDevil', 'LoneRider', 'BlazingSaddle', 'IronHorse', 'WildJack', 'ShotgunSam', 'SilverSpur',
        'BroncoBill', 'PistolPete', 'CactusJack', 'RedHawk', 'SnakeEyes', 'OneShotJoe', 'TriggerTom',
        'BuffaloBill', 'GrizzlyJim', 'BlackHat', 'SundanceKid', 'WhiskeyJoe', 'BadlandsBob'
      ];

      // Bot forte con tempo di reazione 200 ms e nome fisso
      const strongBot = {
        name: 'Micah_Bell_1860',
        reactionTime: 200
      };

      // Stato del gioco
      let playerNickname = '';
      let botNickname = '';
      let botReactionTime = 0;
      let gameStarted = false;
      let signalGiven = false;
      let playerShot = false;
      let botShot = false;
      let playerWin = false;

      // Funzione per scegliere bot casuale tranne il forte
      function chooseRandomBot() {
        const filtered = botNicknames.filter(n => n !== strongBot.name);
        const name = filtered[Math.floor(Math.random() * filtered.length)];
        // Reaction time tra 300 e 600 ms per bot casuale
        const reaction = Math.floor(Math.random() * 301) + 300;
        return { name, reactionTime: reaction };
      }

      // Funzione per aggiornare il bot (puÃ² essere forte o casuale)
      function updateBot(useStrongBot = false) {
        if (useStrongBot) {
          botNickname = strongBot.name;
          botReactionTime = strongBot.reactionTime;
        } else {
          const bot = chooseRandomBot();
          botNickname = bot.name;
          botReactionTime = bot.reactionTime;
        }
        botNameDisplay.textContent = botNickname;
      }

      // Sbloccare audio (per browser che lo bloccano)
      function playSound(audioElem) {
        audioElem.currentTime = 0;
        audioElem.play().catch(e => {
          // fallback: ignora errore
        });
      }

      // Reset per un nuovo round
      function resetRound() {
        signalGiven = false;
        playerShot = false;
        botShot = false;
        playerWin = false;
        statusMsg.textContent = '';
        signal.style.backgroundColor = '#87ceeb'; // azzurro
        playAgainBtn.disabled = true;
        changeBotBtn.disabled = true;
      }

      // Funzione per far partire il round (cambio colore e poi attesa per sparare)
      function startRound() {
        resetRound();

        // Cambio colore dopo un tempo random tra 2 e 5 secondi
        const waitTime = Math.floor(Math.random() * 3000) + 2000;

        setTimeout(() => {
          signal.style.backgroundColor = '#d2c4a1'; // sabbia desertica
          signalGiven = true;

          // Bot spara dopo il suo tempo di reazione (se il player non ha ancora sparato)
          setTimeout(() => {
            if (!playerShot) {
              botShoot();
            }
          }, botReactionTime);
        }, waitTime);
      }

      // Funzione sparo giocatore
      function playerShoot() {
        if (!signalGiven || playerShot) return; // non puÃ² sparare prima del segnale o doppio sparo
        playerShot = true;
        playSound(gunshot);

        // Se bot ha sparato prima
        if (botShot) {
          // Hai perso
          playerWin = false;
          endRound();
        }
        // Se bot non ha sparato
        else {
          // Attendi che bot spari o timeout
          // Timeout 1 secondo per bot se non spara: player vince
          setTimeout(() => {
            if (!botShot) {
              playerWin = true;
              endRound();
            }
          }, 1000);
        }
      }

      // Funzione sparo bot
      function botShoot() {
        if (botShot) return;
        botShot = true;
        playSound(gunshot);

        if (!playerShot) {
          // Bot ha sparato primo => player perde
          playerWin = false;
          endRound();
        }
        else {
          // Se player ha sparato prima => player vince
          playerWin = true;
          endRound();
        }
      }

      // Fine round, mostra messaggio e abilita bottoni
      function endRound() {
        if (playerWin) {
          statusMsg.textContent = `${playerNickname} ha vinto! ðŸ¤ `;
          playSound(winSound);
        } else {
          statusMsg.textContent = `${botNickname} ha vinto! ðŸ’€`;
          playSound(loseSound);
        }
        playAgainBtn.disabled = false;
        changeBotBtn.disabled = false;
      }

      // Evento: clicca Inizia
      startBtn.addEventListener('click', () => {
        const nick = nicknameInput.value.trim();
        if (!nick) {
          alert('Per favore, inserisci un nickname.');
          return;
        }
        playerNickname = nick;
        playerNameDisplay.textContent = playerNickname;

        // Scegli bot casuale iniziale (non forte)
        updateBot(false);

        nicknameInput.style.display = 'none';
        startBtn.style.display = 'none';

        gameArea.style.display = 'block';

        gameStarted = true;
        startRound();
      });

      // Evento tasto spazio per sparare
      window.addEventListener('keydown', e => {
        if (!gameStarted) return;
        if (e.code === 'Space') {
          e.preventDefault(); // Previeni scroll pagina con barra spazio
          playerShoot();
        }
      });

      // Evento touch per sparare (tap su gameArea)
      gameArea.addEventListener('touchstart', e => {
        if (!gameStarted) return;
        e.preventDefault(); // Previeni comportamenti di default su touch
        playerShoot();
      });

      // Gioca ancora con stesso bot e nickname
      playAgainBtn.addEventListener('click', () => {
        if (!gameStarted) return;
        startRound();
      });

      // Cambia avversario (bot diverso) con stesso nickname
      changeBotBtn.addEventListener('click', () => {
        if (!gameStarted) return;
        updateBot(false);
        startRound();
      });
    })();
  </script>
</body>
</html>
